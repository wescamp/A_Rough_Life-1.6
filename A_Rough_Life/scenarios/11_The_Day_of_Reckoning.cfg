#textdomain wesnoth-A_Rough_Life
[scenario]
    name= _ "The Day of Reckoning"
    id=11_The_Day_of_Reckoning
    next_scenario=12_Flip_of_Destiny
	victory_when_enemies_defeated=no
	
	[story]
		[part]
			story= _ "This was it." 
		[/part]
		[part]
			story= _ "Jacques followed the King and the remaining soldiers ever deeper down the cave, until they came to a makeshift encampment at the edge of a wide corridor. Jacques wondered what waited for them at the other side. At the very end, there would be Ruphulus, but Jacques didn't even want to imagine how many bones they would have to crack to get to him." 
	    [/part]
		[part]
			story= _ "Along the way, the King and Kyoko were deep in conversation, with the King stealing a glance now and then towards the book that Kyoko grasped firmly in her hands. Curious though he was, he knew the book was not his riddle to solve, as he was not the one who first heard its call." 
	    [/part]
		[part]
			story= _ "As they reached the encampment, Jacques immediately set off to examine the troops and boost their confidence. This was the time they both dreaded and hoped for - the time of reckoning, when they could settle the score with their evil adversary and truly break his chains."
	    [/part]
		[part]
			story= _ "This was it."
	    [/part]
	[/story]
	
    map_data="{@campaigns/A_Rough_Life/maps/reckoning.map}"
    {SCENARIO_MUSIC "battle.ogg"}
    turns=120

    {UNDERGROUND}
	
    [side]
        side=1
        controller=human
        id=Jacques
        name= _ "Fierce Jacques"
        type=Battle_Commander
		fog=no
		shroud=yes
		canrecruit=yes
        recruit=Orcish Grunt,Saurian Augur,Spearman,Thug,Elvish Archer,Sergeant
        {GOLD 200 150 100}
		{INCOME 12 9 6}
        team_name=Jacques
        village_gold=1
	[/side]

    [side]
        side=2
		type=Fire Dragon
        id=Ruphulus
        name= _ "Ruphulus"
        canrecruit=yes
        recruit=0
        gold=0
        income=0
        [ai]
            aggression=1
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
        team_name=Ruphulus
    [/side]
	
	[side]
        side=3
		type=Death Knight
        id=Dark Knight
        name= _ "Dark Knight"
        canrecruit=yes
        recruit=Death Blade,Revenant,Bone Shooter,Banebow
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
        team_name=Ruphulus
    [/side]
	
	[side]
        side=4
		type=Death Knight
        id=Blood Knight
        name= _ "Blood Knight"
        canrecruit=yes
        recruit=Death Blade,Revenant,Bone Shooter,Banebow
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
        team_name=Ruphulus
    [/side]
	
	[side]
        side=5
		type=Draug
        id=Bone Marshall
        name= _ "Bone Marshall"
        canrecruit=yes
        recruit=Skeleton,Skeleton Archer,Vampire Bat
        {GOLD 90 120 150}
        {INCOME 4 6 8}
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=no
        [/ai]
        team_name=Ruphulus
    [/side]
	
	[side]
        side=6
		type=Skeletal Dragon
        id=Pet of Death
        name= _ "Pet of Death"
        canrecruit=yes
        recruit=Chocobone,Deathblade,Revenant,Bone Shooter,Skeleton,Skeleton Archer
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=no
        [/ai]
        team_name=Ruphulus
    [/side]

	[side]
        side=7
		type=Ancient Lich
        id=Counsellor of Death
        name= _ "Counsellor of Death"
        canrecruit=yes
        recruit=Lich,Chocobone,Deathblade,Revenant,Banebow,Skeleton,Skeleton Archer
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=no
        [/ai]
        team_name=Ruphulus
    [/side]
	
	[side]
        side=8
		type=Chocobone
        id=Fear
        name= _ "Fear"
        canrecruit=yes
        recruit=0
        gold=0
		income=0
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
        team_name=Ruphulus
    [/side]

	[side]
        side=9
		type=Chocobone
        id=Loathing
        name= _ "Loathing"
        canrecruit=yes
        recruit=0
        gold=0
		income=0
        [ai]
            aggression=0.5
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
        team_name=Ruphulus
    [/side]
	
    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Ruphulus."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jacques or Kyoko or turns run out."
                condition=lose
            [/objective]
        [/objectives]
		[recall]
            id=George
		[/recall]
        [recall]
            id=Paula
		[/recall]
		[recall]
            id=Carl
		[/recall]
		[recall]
            id=Almain
		[/recall]
		[recall]
			id=Kyoko
		[/recall]
		[recall]
			id=King Bombasan
		[/recall]
		[recall]
			id=Semper
		[/recall]
		[recall]
			id=Fi
		[/recall]
		
		[item]
			x,y=7,37
			halo=scenery/oak-leaning.png
		[/item]
		[item]
			x,y=18,30
			halo=items/dragonstatue.png
		[/item]
		[item]
			x,y=22,30
			halo=items/dragonstatue.png
		[/item]
		[item]
			x,y=18,24
			halo=scenery/signpost.png
		[/item]
		[item]
			x,y=8,28
			halo=scenery/signpost.png
		[/item]
		[item]
			x,y=20,21
			halo=items/burial.png
		[/item]
		[item]
			x,y=22,21
			halo=items/burial.png
		[/item]
		[item]
			x,y=40,18
			halo=items/bones.png
		[/item]
		[item]
			x,y=30,12
			halo=items/bonestack.png
		[/item]
		[item]
			x,y=11,2
			halo=items/bones.png
		[/item]
		[item]
			x,y=12,1
			halo=items/bones.png
		[/item]
		[item]
			x,y=12,2
			halo=items/bones.png
		[/item]
		[item]
			x,y=1,1
			halo=items/altar-evil.png
		[/item]
		[item]
			x,y=7,1
			halo=items/altar-evil.png
		[/item]
		[item]
			x,y=1,4
			halo=items/burial.png
		[/item]
		[item]
			x,y=7,4
			halo=items/burial.png
		[/item]
		[item]
			x,y=1,7
			halo=items/burial.png
		[/item]
		[item]
			x,y=7,7
			halo=items/burial.png
		[/item]
		{MODIFY_UNIT id=Jacques name _"Fierce Jacques"}
[/event]

    [event]
        name=start

		{CLEAR_VARIABLE Jacques_store}
		
		{CLEAR_VARIABLE Ruphulus_store}
		
		{CLEAR_VARIABLE transition}
        {VARIABLE transition 0}
		
		{CLEAR_VARIABLE bridges_built}
        {VARIABLE bridges_built 0}

		{CLEAR_VARIABLE Krug}
        {VARIABLE Krug 0}
		
		{CLEAR_VARIABLE Bombasan_dead}
        {VARIABLE Bombasan_dead 0}
		
		{CLEAR_VARIABLE Kyoko_knows}
        {VARIABLE Kyoko_knows 0}
				
		[if]
			[have_unit]
				type=Thief
			[/have_unit]
		[then]
			[set_variable]
				name=transition
				add=1
			[/set_variable]
			[message]
				speaker=narrator
				message= _ "Albeit he has led his troops all the way to the final battle, Jacques can hardly bear to look them in their eyes. He has personally survived this far only by hiding behing the shoulders of others more steadfast than him and by sending others to do his share of the fighting. If he does not prove himself in battle soon, his good standing may be lost forever."
				image=wesnoth-icon.png
			[/message]
		[/then]
		[else]
			[if]
				[have_unit]
					type=Sand_Trapper
				[/have_unit]
			[then]
				[set_variable]
					name=transition
					add=2
				[/set_variable]
				[message]
					speaker=narrator
					message= _ "Looking at the soldiers and trusty friends around him, Jacques sees several that he thinks would be better fit to lead this expedition than him. Sure, he has taken a blow here or a cut there, but mostly he personally has stayed out of harm's way. He knows he should lead by example, and is determined to make it so this time around."
					image=wesnoth-icon.png
				[/message]
			[/then]
			[/if]
		[/else]
		[/if]
		
        [message]
            speaker=narrator
            message= _ "As the troops get ready for the assault, Jacques signals that they should wait just a little while longer. He hopes that Kyoko might be able to decipher whatever help the words in the Book of Prophecies may be able to give them."
			image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "After several fruitless attempts, Kyoko tries yet again to concentrate and opens the book. And again, she is not drawn inside and shown images, but rather served what seems a trite old saying: 'Bridges are burnt when friendships end, and not before a few bones are broken will new ones be built.'"
			image=wesnoth-icon.png
        [/message]
		[message]
            speaker=Kyoko
            message= _ "I do not care about bridges! How do we defeat Ruphulus, that is all I would know. What is the fate that we may impose on him?"
        [/message]
		[message]
            speaker=narrator
            message= _ "As she speaks up, the words in the book change. Now, the message reads: 'She who would travel in a straight line shall find no end, but she who will find the time to lean to one side may see better that which awaits.'"
			image=wesnoth-icon.png
        [/message]
		[message]
            speaker=Jacques
            message= _ "Kyoko? Any luck?"
        [/message]
		[message]
            speaker=Kyoko
            message= _ "I'm afraid not, although I do believe the book is trying to tell me something, but it is a message I do not fully understand. Perhaps it's simply that this is not the best place to consult the Book."
		[/message]
		[message]
            speaker=Jacques
            message= _ "If not here, then where? For I fear that nothing good lies up ahead."
        [/message]
		[message]
            speaker=King Bombasan
            message= _ "Things are as they are, and we can't help them. Perhaps the chance for miracles will still come. In the meantime, however, we should worry about the enemy's forces getting too big. I fear we have no time to waste."
        [/message]
		[message]
            speaker=Jacques
            message= _ "You are right, of course. Friends, comrades, onwards, and may open skies smile upon us once more!"
        [/message]
		[set_recruit]
        recruit=Orcish Grunt,Saurian Augur,Spearman,Thug,Elvish Archer
        side=1
		[/set_recruit]
		[if]
			[variable]
				name=dwarves
				equals=1
			[/variable]
		[then]
		[allow_recruit]
			side=1
			type=Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Thunderer
		[/allow_recruit]
		[/then]
		[/if]
    [/event]

[event]
	name=turn 2
	[message]
        speaker=Loathing
        message= _ "I simply loathe staring down eerie corridors, what about you, brother?"
    [/message]
	[message]
        speaker=Fear
        message= _ "I don't like it, either, makes me afraid of what might come up."
    [/message]
	[message]
        speaker=Loathing
        message= _ "Hey! Do I see someone approaching? Heavens help me if it's those loathsome dwarves again!"
    [/message]
	[message]
        speaker=Fear
        message= _ "Don't frighten me like that! I'm sure it's just some weary travellers lost on their way, looking for a place to crash."
    [/message]
	[message]
        speaker=Jacques
        message= _ "Not exactly crash, but crush - crush your bones, that is!"
    [/message]
[/event]

[event]
	name=turn 3
	[message]
        speaker=Fear
        message= _ "Loathing, brother, where art thou?"
    [/message]
	[message]
        speaker=Loathing
        message= _ "The only thing that I do not fear is Fear itself."
    [/message]
	[message]
        speaker=Fear
        message= _ "Should we ask for help?"
    [/message]
	[message]
        speaker=Loathing
        message= _ "Help!"
    [/message]
[/event]

[event]
	name=turn 4
	[message]
        speaker=Fear
        message= _ "Are we still here?"
    [/message]
	[message]
        speaker=Loathing
        message= _ "My my, they go about their business very slowly, don't they?"
    [/message]
	[message]
        speaker=Fear
        message= _ "One wonders if they'll even get to the boss in time at this rate."
    [/message]
	[message]
        speaker=Loathing
        message= _ "Perhaps that big stony fellow will want to help them to speed things up."
    [/message]
[/event]
	
[event]
	name=post_advance
	first_time_only=no
	[filter]
		id=Jacques
	[/filter]
	[if]
		[variable]
            name=transition
            equals=2
		[/variable]
	[then]
		{TRANSFORM_UNIT type=Sand_Ranger Battle_Commander}
		[store_unit]
			[filter]
				id=Jacques
			[/filter]
			variable=Jacques_store
		[/store_unit]
		{VARIABLE Jacques_store.experience 0}
		[unstore_unit]
			variable=Jacques_store
		[/unstore_unit]
		{FULL_HEAL (id=Jacques)}
		{CLEAR_VARIABLE Jacques_store}
		[message]
			speaker=narrator
			message= _ "Jacques realises that the shadow no longer frightens him. He is calm and determined. His troops around him are reinvigorated and fight on with new purpose. The dark night seems a little brighter. He has become a true commander."
			image=wesnoth-icon.png
		[/message]
		[set_variable]
			name=transition
			add=1
		[/set_variable]
	[/then]
	
	[else]
	
	[if]
		[variable]
            name=transition
            equals=1
		[/variable]
	[then]	
		{TRANSFORM_UNIT type=Rogue Sand_Trapper}
		[store_unit]
			[filter]
				id=Jacques
			[/filter]
			variable=Jacques_store
		[/store_unit]
		{VARIABLE Jacques_store.experience 0}
		[unstore_unit]
			variable=Jacques_store
		[/unstore_unit]
		{FULL_HEAL (id=Jacques)}
		{CLEAR_VARIABLE Jacques_store}
		[message]
			speaker=narrator
			message= _ "Finally, Jacques feels that he has set on the road to reaching his full potential, but he still has some way to go."
			image=wesnoth-icon.png
		[/message]
		[set_variable]
			name=transition
			add=1
		[/set_variable]
	[/then]
	[/if]
	
	[/else]
	[/if]
[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x,y=18,24
		[/filter]
		[message]
			speaker=narrator
			message= _ "Forbidden entry! By order of the Dragon Lord!"
		    image=wesnoth-icon.png
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x,y=8,28
		[/filter]
		[message]
			speaker=narrator
			message= _ "Rule #1 states: Obey orders or die! And you didn't obey orders..."
		    image=wesnoth-icon.png
		[/message]
		[unit]
			side=2
			type=Revenant
			x,y=8,29
		[/unit]
		[unit]
			side=2
			type=Skeleton
			x,y=8,26
		[/unit]
		[unit]
			side=2
			type=Skeleton Archer
			x,y=10,29
		[/unit]
	[/event]
	
	[event]
		name=moveto
		[filter]
			side=1
			x,y=1-16,34-40
		[/filter]
		[remove_shroud]
			side=1
			x,y=0-17,33-41
		[/remove_shroud]
		[message]
			speaker=unit
			message= _ "What a calm, peaceful place! I wonder why it has been put here?"
		[/message]
	[/event]
	
	[event]
		name=moveto
		[filter]
			id=Kyoko
			x,y=1-16,34-40
		[/filter]
		[message]
			speaker=Kyoko
			message= _ "Yes, I think I was right in coming here in order to consult the book. Now just to find the proper place..."
		[/message]
	[/event]
	
	[event]
		name=moveto
		[filter]
			id=Kyoko
			x,y=7,37
		[/filter]
		[message]
			speaker=Kyoko
			message= _ "A little island with an oak tree leaning to one side! I think I found the proper place, it's so calm, so soothing. Why did such a monster as Ruphulus create this place?"
		[/message]
		[message]
			speaker=narrator
			message= _ "As Kyoko leans against a tree, she almost wishes she could stay here forever. It is a place which does her extremely well, and she has an eerie feeling she knows why. She opens the Book of Prophecies. This time, she is absorbed into the Book anew, and her head feels with images."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=narrator
			message= _ "First, she sees herself, singing a song during the last celebrations of her father's birthday, as the vision pans to show Ruphulus watching her with a gleam in his eyes. What disturbs her is that there is lust, yes, but also something more. Was it genuine affection?"
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=narrator
			message= _ "Then, she sees herself collapsed on the floor, as Ruphulus gently picks her up, carries her down a corridor and transforms into a dragon. So it was his own wings she heard flapping that night! He lifts her up in the air and flies towards the mountains, but then he doesn't drop her by accident as she first thought. She sees the dragon circle for awhile, until he spots a young wose approaching an oasis. Swiftly the dragon swoops down and then places Kyoko in the shrub. He lifts again and watches from afar as the wose stumbles upon the young maiden, then flies away."
			image=wesnoth-icon.png
		[/message]
		[if]
			[variable]
                name=Kyoko_safe
                equals=1
            [/variable]
		[then]
		[message]
            speaker=narrator
            message= _ "Finally, she is shown images from the battle that day when they confronted the evil mage and he transformed into the dragon before their very eyes. Mighty was his rage, but not towards Kyoko, whom he did his utmost to spare."
			image=wesnoth-icon.png
        [/message]
		[/then]
		[/if]
		[message]
			speaker=narrator
			message= _ "Kyoko wonders why she is being shown the images from the past, until she realises their significance. The evil mage is in love with her! That is why he could not bring himself to do her harm, and that was why he accosted her that time when he lured her into his chambers. She realises that this is also the reason for the creation of this very place: he has created it for her, as a haven for her to relax in and enjoy."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=narrator
			message= _ "With this awareness, she is swept into the Book once more, and shown the image of herself, walking across a bridge, broken and unbroken, towards a dragon. But, and that puzzles her, she is not full of anger, she does not wield her staff in combat. No, she is smiling, and she opens her arms as if she wanted to embrace the big dragon. The dragon seems puzzled and looks at her with its big, expectant, hopeful eyes."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=narrator
			message= _ "Kyoko is puzzled by this image. And then it becomes clear to her. Life is not fair, Luxor said. This, as she has come to realise, is a truth that cuts both ways. Finally, she knows what she has to do."
			image=wesnoth-icon.png
		[/message]
		[set_variable]
			name=Kyoko_knows
			add=1
		[/set_variable]
	[/event]
	
[event]
    name=die
	[filter]
		id=Kyoko
	[/filter]
    [message]
        speaker=narrator
        message= _ "The Princess fought like a valiant fighter worthy of her dwarvish ancestry and breezed through the enemy ranks with speed worthy of her elven one. And yet, she could not escape or overcome the adversary that struck her down..."
		image=wesnoth-icon.png
    [/message]
	[endlevel]
        result=defeat
    [/endlevel]
[/event]
	
[event]
    name=die
	first_time_only=no
	[filter]
		id=Ruphulus
	[/filter]
    [message]
		id=Ruphulus
		message= _ "Hahaha! You think your puny little swords and arrows can kill me?"
	[/message]
	[message]
        speaker=narrator
        message= _ "Just when they think they have the Dragon defeated, Ruphulus rises in front of them again, fully healed."
		image=wesnoth-icon.png
    [/message]
	[side]
		side=2
		type=Fire Dragon
        id=Ruphulus
        name= _ "Ruphulus"
        canrecruit=yes
        recruit=0
        gold=0
        income=0
        x,y=4,3
		[ai]
            aggression=1
			side=2
            leader_value=3
            village_value=1
            grouping=no
            caution=0.0
            passive_leader=yes
        [/ai]
	[/side]
	{FULL_HEAL (id=Ruphulus)}
[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x,y=29,10
		[/filter]
		{TELEPORT_TILE 29 10 28 10}
		[unit]
			type=Great Troll
			id=Krug
			name= _ "Krug"
			side=8
			x,y=29,10
		[/unit]
		[message]
			speaker=Krug
			message= _ "You haven't had enough yet, have you? Well, I can always enlarge that bonestack at the bottom of the mountain. You bonehea... Hey! This one has some meat still left on its bones - how can that be?"
		[/message]
		[message]
			x,y=28,10
			message= _ "Huh? We thought nobody but the undead could be found here. I gather you are not a minion of Ruphulus, are you?"
		[/message]
		[message]
			speaker=Krug
			message= _ "Meat on its bones, and it talks like it does not care for those stupid old boneheads. Reminds me of that crazy explorer, it does. Hmmm... Who is this weakling?"
		[/message]
		[message]
			x,y=28,10
			message= _ "We have come with King Bombasan to defeat Ruphulus and his army, and to liberate these caves once more!"
		[/message]
		[message]
			speaker=Krug
			message= _ "Ha! Liberate, weaklings says. Would they have the caves liberated of Krug, as well?"
		[/message]
		[message]
			x,y=28,10
			message= _ "Only if you wanted to attack us and invade our own lands further up towards the surface."
		[/message]
		[message]
			speaker=Krug
			message= _ "The surface, ha! The surface is for weaklings. Krug is perfectly happy here, if only the pesky bones would not disturb him."
		[/message]
		[message]
			x,y=28,10
			message= _ "Then it seems we may have a common purpose - we don't like them either. Would you join us in our fight against them?"
		[/message]
		[message]
			speaker=Krug
			message= _ "And be rid of them, and have the peace and quiet once more? Yes, Krug would like that, so he joins you."
		[/message]
		[kill]
			id=Krug
		[/kill]
		[unit]
			type=Great Troll
			id=Krug
			name= _ "Krug"
			side=1
			x,y=29,10
		[/unit]
		[set_variable]
				name=Krug
				add=1
		[/set_variable]
	[/event]
	
	[event]
		name=moveto
		[filter]
			side=1
			x,y=40,20
		[/filter]
		[message]
			speaker=narrator
			message= _ "The hut is empty, but there is something strange about it. It is not as barren as the others, and has garments and strange equipment that surely would not be used by the minions of Ruphulus. It seems deserted now, but who had lived here?"
			image=wesnoth-icon.png
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x,y=40,18
		[/filter]
		[message]
			speaker=narrator
			message= _ "You stumble upon a dead body that is different from the other sights of scattered bones. It seems that the person died relatively recently. Scattered around the body, you find various instruments and maps of the area."
			image=wesnoth-icon.png
		[/message]
		[if]
			[variable]
				name=Krug
				equals=1
			[/variable]
		[then]
			[message]
				speaker=Jacques
				message= _ "Perhaps this is the explorer that Krug mentioned when we first came across him!"
			[/message]
		[/then]
		[/if]
		[message]
			speaker=narrator
			message= _ "They pick up and consult the maps. As they do so, the layout of this part of the cave system becomes much clearer."
			image=wesnoth-icon.png
		[/message]
		[remove_shroud]
			side=1
			x,y=9-41,0-22
		[/remove_shroud]
	[/event]

[event]
    name=die
	[filter]
		id=Bone Marshall
	[/filter]
    [message]
        speaker=Bone Marshall
        message= _ "Damn you, you fools. I have let the King down, and the path that leads to him has become a little clearer. But be warned, for there are adversaries much stronger than me that you would have to overcome to get to him, and you shall not succeed!"
	[/message]
	{MODIFY_TERRAIN Qxu^Bs| 4 9}
	[set_variable]
		name=bridges_built
		add=1
	[/set_variable]
[/event]

[event]
    name=die
	[filter]
		id=Pet of Death
	[/filter]
    [message]
        speaker=Pet of Death
        message= _ "Arghh, I failed, and another stone is added to the bridge that you must cross. But still, you won't succeed!"
	[/message]
	{MODIFY_TERRAIN Qxu^Bs| 4 7}
	[set_variable]
		name=bridges_built
		add=1
	[/set_variable]
[/event]
	
[event]
    name=die
	[filter]
		id=Counsellor of Death
	[/filter]
    [message]
        speaker=Counsellor of Death
        message= _ "Hahahaha, you may have defeated me and got yet one more step closer to the Dragon Lord, but so much the worse for you, for who wants to feel the wrath of Death itself?"
	[/message]
	{MODIFY_TERRAIN Qxu^Bs| 4 5}
	[set_variable]
		name=bridges_built
		add=1
	[/set_variable]
[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			id=Kyoko
			x,y=2-6,4-11
		[/filter]
		[if]
			[variable]
				name=Kyoko_knows
				equals=1
			[/variable]
		[then]
		
		[if]
			[variable]
				name=bridges_built
				equals=3
			[/variable]
		[then]
		
		[message]
			speaker=narrator
			message= _ "As Kyoko steps into the chamber of the Dragon, she yells out for everyone to stop fighting. In bewilderment, those who hear her command obey."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=Kyoko
			message= _ "I need to speak to Ruphulus. Alone."
		[/message]
		[message]
			speaker=Jacques
			message= _ "No, Kyoko! Don't do it. There is no need to. We can beat the Dragon!"
		[/message]
		[message]
			speaker=Kyoko
			message= _ "Shush, brute! What needs to be done needs to be done. Besides, it's not only that I need to do it, I want to."
		[/message]
		[message]
			speaker=narrator
			message= _ "Jacques cannot comprehend it. Was she able to consult the Book? What did she see? Must she really sacrifice herself in order to save the others? He knows he cannot stop her, so along with the others he steps aside and lets her do whatever it is she needs to do."
			image=wesnoth-icon.png
		[/message]
		[if]
			[have_unit]
				x,y=4,4
			[/have_unit]
		[then]
		{TELEPORT_TILE 4 4 4 15}
		[/then]
		[/if]
		[message]
			speaker=narrator
			message= _ "The Dragon is just as perplexed as she approaches him. He looks at her with unsure eyes, as she smiles reassuringly."
			image=wesnoth-icon.png
		[/message]
		[music]
			name=the_king_is_dead.ogg
			immediate=yes
		[/music]
		[message]
			speaker=Kyoko
			message= _ "It is beautiful. The little haven you built for me, it's truly beautiful."
		[/message]
		[message]
			speaker=Ruphulus
			message= _ "It is?"
		[/message]
		[message]
			speaker=narrator
			message= _ "The Dragon wavers, unsure what to think of it."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=Kyoko
			message= _ "Yes, it is. I never thought you had such beauty in you. Why didn't you show it to me earlier?"
		[/message]
		[message]
			speaker=Ruphulus
			message= _ "I... I... wanted to, but I never really got the chance. When it was done, I tried to invite you to see it, but you turned me down, remember? It still hurts when I think of that moment."
		[/message]
		[message]
			speaker=Kyoko
			message= _ "I do, of course I do. I didn't like being accosted like that. But had I known you had such a thing of beauty waiting for me, I would behave differently. Sorry I kicked you."
		[/message]
		[message]
			speaker=narrator
			message= _ "As she speaks, Kyoko approaches the Dragon who is becoming visibly agitated."
			image=wesnoth-icon.png
		[/message]
		{TELEPORT_UNIT (
		id=Kyoko
		) 4 4}
		[message]
			speaker=Kyoko
			message= _ "I'm sorry it turned out like that. Oh, Ruphulus, have I driven you to become a dragon? Can you never be the same old Ruphulus again? I would so much like to apologise to the man I once knew."
		[/message]
		[message]
			speaker=Ruphulus
			message= _ "Wait, my dear Kyoko. This is but one impenetratable shell that I use, but the old Ruphulus is still inside. Here he is, as eager to talk to you as you are to him."
		[/message]
		
		[sound]
			name=lightning.ogg
		[/sound]
		
			[store_unit]
			[filter]
				id=Ruphulus
			[/filter]
			variable=Ruphulus_store
			[/store_unit]
			{VARIABLE Ruphulus_store.type (Arch Mage)}
			{VARIABLE Ruphulus_store.experience 0}
			[unstore_unit]
				variable=Ruphulus_store
			[/unstore_unit]
			{FULL_HEAL (id=Ruphulus)}
			{CLEAR_VARIABLE Ruphulus_store}
		
		[message]
			speaker=narrator
			message= _ "With a flash, the dragon is transformed into the old mage in his human form once more. Mighty though he is, his chin and hands shake as he looks at Kyoko coming ever nearer."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=Kyoko
			message= _ "Oh, Ruphulus, it's so nice to see you again. What horrors have been transpiring to me, you would never know. Can you help, can you make it stop?"
		[/message]
		[message]
			speaker=narrator
			message= _ "With these words, Kyoko throws herself at Ruphulus and flings her arms around him in embrace. The old mage seems to be at a loss for words as he tries to console her."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=Ruphulus
			message= _ "What do you mean, help? I can make your life wonderful, and make you the queen of the world. As soon as we defeat the advers..."
		[/message]
		[message]
			speaker=narrator
			message= _ "As the old mage speaks with tremor in his heart and mind, he fails to notice the imperceptible movement of Kyoko's hand as it reaches for a secret dagger and stabs the mage in the neck. The mage is cut off in the middle of the sentence and looks at Kyoko with puzzled eyes."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=Ruphulus
			message= _ "Wha-at? Di.. did you stab me? Oh, the pain... What is this warmth spilling down my neck? Is it my blood? Why is it suddenly becoming so cold? Are you cold, dear Kyoko? Can you see me? All is dark. I am dark... I... I deserve to die... I lo..."
		[/message]
		[message]
			speaker=narrator
			message= _ "As life's energy slowly sips out of the old mage, Kyoko can do nothing but watch. Sure, he was an evil man who wished nothing but destruction upon the world. And yet, she could not help but feel saddened by what she has done, betraying a man's - albeit an evil's man - love to bring about his end."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=narrator
			message= _ "As Ruphulus finally collapses to the floor, dead, nothing unusual happens. There is no lightning bolt, no dragon reappears, no cry of desperation is heard from around the cave. Still, with most of the sorcerer's minions already defeated, it doesn't take long for Jacques and his troops to secure the caves and make sure that the undead menace is no more."
			image=wesnoth-icon.png
		[/message]
		[kill]
			id=Krug
		[/kill]
		[kill]
			id=King Bombasan
		[/kill]
		[endlevel]
			result=victory
		[/endlevel]
		[/then]
		[else]
			[message]
				speaker=Kyoko
				message= _ "I know what I need to do, but I still need to be able to even get to Ruphulus to do it."
			[/message]	
		[/else]
		[/if]
		[/then]
		[else]
			[message]
				speaker=Kyoko
				message= _ "I know I can bring this to an end, somehow, but where will I learn how?"
			[/message]	
		[/else]
		[/if]
	[/event]

[event]
    name=die
	[filter]
		id=Jacques
	[/filter]
    [message]
        speaker=narrator
        message= _ "Leading his forces valiantly into battle, Jacques wants to lead by example and plunges into the thick of the struggle. Suddenly, he realises that he is losing strength and that he has gone too far ahead to benefit from the defense of his troops. He stands for as long as he can, but the swarms of enemies finally overcome him."
		image=wesnoth-icon.png
    [/message]
	[endlevel]
        result=defeat
    [/endlevel]
[/event]

[event]
    name=die
	[filter]
		id=King Bombasan
	[/filter]
    [message]
        speaker=narrator
        message= _ "The King fights like he is a young man again. His hammer is music to his soldiers' ears as it cracks against the undead skulls, and each of his lightning bolts sends another message of light and hope as it shatters their enemies' bones. Still, the King is not a young man, and his powers slowly desert him. He fights on, ever weaker, until a blow is struck over his head that he can no longer deflect. The King is no more."
		image=wesnoth-icon.png
    [/message]
	[message]
        speaker=narrator
        message= _ "But the soldiers do not despair. No, they see Jacques leading them into battle and they are determined to fight on ever more bravely, to pay tribute to the valiant King and his honourable deeds at this dark time."
		image=wesnoth-icon.png
    [/message]
	[set_variable]
		name=Bombasan_dead
		add=1
	[/set_variable]
[/event]

[event]
    name=time over
    [message]
        speaker=narrator
        message= _ "Jacques and his soldiers tried their best, and for a long time it seemed they stood a chance against the dragon. And yet, their forces dwindled down just as the Dragon unleashed a new wave of undead upon them, and they were overcome."
		image=wesnoth-icon.png
    [/message]
	[endlevel]
        result=defeat
    [/endlevel]
[/event]
		
[/scenario]
